<html>
<head>
  <title>chap9文件与文件系统的压缩与打包</title>
  <basefont face="微软雅黑" size="2">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="exporter-version" content="Evernote Windows/274507; Windows/6.3.9600;">
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="363">
<h1>chap9文件与文件系统的压缩与打包</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><ul><li> 常见的两种压缩方法</li><li style="list-style: none; display: inline"><ul><li>数据通过二进制数字存储，通常以字节为单位</li><li>1、比如数字8，存储结果为0000 1000，前端有四个bits空闲被浪费，通过复杂的算法，就能把这些浪费的空间利用起来</li><li>2、统计重复数据的个数，实现文件记录的精简</li><li>压缩前后占用空间的比例称为“压缩比”</li></ul></li><li>常见压缩与打包的扩展名</li><li style="list-style: none; display: inline"><ul><li>*.Z：compress程序压缩</li><li>*.gz：gzip程序压缩</li><li>*.bz2：bzip2程序压缩</li><li>*.tar：tar程序打包，未压缩</li><li>*.tar.gz：用gzip压缩后用tar打包</li><li>*.tar.bz2：bzip2压缩后用tar打包</li><li> </li><li>压缩程序发展：compress --&gt; gzip --&gt; bzip2（向下兼容）</li><li style="list-style: none; display: inline"><ul><li>gzip和bzip2可以被Windows的WinRAR识别</li></ul></li><li>打包程序：tar</li></ul></li><li>compress（*.Z）</li><li style="list-style: none; display: inline"><ul><li>基本语法：</li><li style="list-style: none; display: inline"><ul><li>压缩：compress [-rcv] dirname/filename</li><li><ul><li>-r：连同目录下的文件也给予压缩</li><li>-c：将压缩数据输出称为standard output（输出到屏幕）</li><li style="list-style: none; display: inline"><ul><li>一般默认会删除源文件</li><li>如果要保留，可以借助该参数</li><li>如：compress -c man.config &gt; man.config.back.Z</li></ul></li><li>-v：显示压缩后的的文件信息和压缩过程中一些文件名的变化</li></ul></li><li>解压缩：uncompress ***.Z</li></ul></li></ul></li><li>gzip（*.gz）</li><li style="list-style: none; display: inline"><ul><li>基本语法</li><li style="list-style: none; display: inline"><ul><li>（解）压缩：gzip [-cdtv#] filename</li><li style="list-style: none; display: inline"><ul><li>-c：将压缩数据输出到屏幕上，可以通过数据流重定向来处理</li><li style="list-style: none; display: inline"><ul><li>跟compress的-c参数一样可以用来保留源文件</li></ul></li><li>-d：解压缩</li><li style="list-style: none; display: inline"><ul><li>等价于gunzip，但是建议使用gzip -d</li></ul></li><li>-t：检验压缩文件一致性</li><li>-v：显示压缩比等信息</li><li>-#：压缩等级</li><li style="list-style: none; display: inline"><ul><li>-1：最快，但是压缩比最差</li><li>-9：最慢，但是压缩比最好</li><li>-6：默认等级</li></ul></li></ul></li><li>读取：zcat ***.gz</li><li style="list-style: none; display: inline"><ul><li>读取的是纯文本文件压缩后的文件</li></ul></li></ul></li></ul></li><li>bzip2（*.bz2）</li><li style="list-style: none; display: inline"><ul><li>基本语法</li><li style="list-style: none; display: inline"><ul><li>（解）压缩：bzip2 [-cdkzv#] filename</li><li style="list-style: none; display: inline"><ul><li>-c：将压缩过程中产生的数据输出到屏幕上</li><li style="list-style: none; display: inline"><ul><li>和compress和gzip的-c参数一样</li></ul></li><li>-d：解压缩</li><li style="list-style: none; display: inline"><ul><li>等价于bunzip2，但还是建议使用bzip2 -d</li></ul></li><li>-k：保留源文件</li><li>-z：压缩</li><li>-v：显示压缩比等信息</li><li>-#：压缩等级</li><li style="list-style: none; display: inline"><ul><li>与gzip相同</li></ul></li></ul></li><li>读取：bzcat ***.bz2</li></ul></li></ul></li><li>tar（*.tar / *.tar.gz / *.tar.bz2）</li><li style="list-style: none; display: inline"><ul><li>基本语法</li><li style="list-style: none; display: inline"><ul><li>打包压缩：tar [-j | -z] [-cv] [-f new_filename] filename1, filename2, filename3,.........</li><li style="list-style: none; display: inline"><ul><li>-p：（小写）保留数据原本的权限和属性，常用于备份重要的配置文件</li><li>-P：（大写）保留绝对路径，允许备份数据存在根目录</li><li style="list-style: none; display: inline"><ul><li>默认会删除根目录，如“/etc”会变成“etc”</li><li>默认情况下会警告：&quot;tar:Removing leading `\` from menber names&quot;</li></ul></li></ul></li><li>查看文件名：tar [-j | -z] [-tv] [-f filename]</li><li>解压：tar [-j | -z] [-xv] [-f filename [filename]] [-C dirname]</li><li style="list-style: none; display: inline"><ul><li>-c：新建打包文件</li><li>-t：查看打包文件的内容</li><li>-x：解包或者解压</li><li style="list-style: none; display: inline"><ul><li>-C 目录：解包或解压到指定目录</li><li>默认会解包或解压到当前目录</li><li>如果打包压缩时加入了-P参数，会解包或解压到它的原目录</li></ul></li><li>======以上三种参数是三种模式，不能同时使用======</li><li>-j：使用bzip2，文件名最好为*.tar.bz2</li><li>-z：使用 gzip，文件名最好为*.tar.gz</li><li>======以上两个参数指定了压缩方式=====</li><li>-v：显示正在处理的文件名</li><li style="list-style: none; display: inline"><ul><li>如果是查看文件，加入该参数表示显示文件的详细信息</li></ul></li><li>-f filename：文件名</li><li style="list-style: none; display: inline"><ul><li>tar不会主动创建文件名</li><li>如果是解压，还可以接着在filename继续指定要解压的文件（注意考虑是带不带根目录的）</li></ul></li><li>--exclude=FILE：忽略FILE文件，不进行打包</li></ul></li></ul></li><li>常用指令</li><li style="list-style: none; display: inline"><ul><li>压缩：tar -jcv -f new_filename.tar.bz2 filename1, filename2, .........</li><li>查询：tar -jtv -f filename.tar.bz2</li><li>解压：tar -jxv -f filename.tar.bz2 -C destination</li></ul></li><li>查看包含关键词（以aaa为例）的文件</li><li style="list-style: none; display: inline"><ul><li>tar -jtv -f filename | grep 'aaa'</li><li>grep是选取关键词的功能</li></ul></li><li>只备份比某文件更新的文件</li><li style="list-style: none; display: inline"><ul><li>先用ll命令查看该文件的time</li><li>给tar命令加入--newer参数：</li><li style="list-style: none; display: inline"><ul><li>--newer=&quot;2008/09/22&quot;：同时比较ctime和mtime</li><li>--newer-mtime：只比较mtime</li><li>--newer-ctime：只比较ctime</li></ul></li><li>如：tar -jcv -f /root/etc.newer.tar.bz2 --newer-mtime=&quot;2008/09/22&quot; /etc/*</li><li style="list-style: none; display: inline"><ul><li>备份/etc目录下mtime比该时间早的文件</li></ul></li></ul></li><li>tarfile和tarball</li><li style="list-style: none; display: inline"><ul><li>tarfile是纯粹打包的文件</li><li>tarball是打包后又进行压缩的文件</li></ul></li><li>tar还可以把文件打包到特殊设备上去，比如磁带机（一次性读取/写入）</li><li style="list-style: none; display: inline"><ul><li>某些设备是不能直接用cp命令写入，但tar可以</li><li>如：tar -cv -f /dev/st0 /home /root /etc，常用该命令来进行备份</li></ul></li><li>特殊应用：利用管道命令与数据流</li></ul></li><li>完整备份工具：dump</li><li style="list-style: none; display: inline"><ul><li>基本语法1：dump [-Suvj] [-level] [-f 备份文件] 待备份数据</li><li style="list-style: none; display: inline"><ul><li>-S：仅列出所需的磁盘空间</li><li>-u：将这次备份记录到/etc/dumpdates文件中</li><li style="list-style: none; display: inline"><ul><li>文件记录内容包括文件系统、等级、ctime</li></ul></li><li>-v：显示过程</li><li>-j：使用bzip2，默认等级2</li><li style="list-style: none; display: inline"><ul><li>一般dump不会使用压缩功能</li></ul></li><li>-level：指定等级-0 ~ -9共十个等级</li><li style="list-style: none; display: inline"><ul><li>-0为完整备份</li><li>-1在参考-0的基础上对发生更改的数据进行备份</li><li>-2在参考-1的基础上对发生更改的数据进行备份</li><li>……（以此类推）</li></ul></li><li>-f：后接生成的文件名</li></ul></li><li>基本语法2：dump -W</li><li style="list-style: none; display: inline"><ul><li>列出具有dump设置的分区是否备份过</li><li>参考了/etc/fstab文件</li></ul></li><li>若待备份数据为单一文件系统</li><li style="list-style: none; display: inline"><ul><li>可以使用完整的dump功能</li><li>可以使用挂载点  或  设备文件名</li></ul></li><li>若待备份数据只是目录</li><li style="list-style: none; display: inline"><ul><li>所有备份数据必须在此目录下</li><li>只能使用level 0也就是完整备份</li><li>不支持-u，无法创建相应的时间记录文件</li></ul></li></ul></li><li>恢复dump备份数据：restore</li><li style="list-style: none; display: inline"><ul><li>查看dump文件：restore -t [-f dumpname] [-h]</li><li style="list-style: none; display: inline"><ul><li>-h：查看完整备份数据中的inode与文件系统label等信息</li><li>如果备份数据经过压缩，第一行会提示“dumptape is compressed”</li></ul></li><li>比较dump与实际文件：restore -C [-f dumpname] [-D 挂载点]</li><li style="list-style: none; display: inline"><ul><li>列出dump有记录，且目前系统文件不同的文件</li><li>不列出新增的文件</li></ul></li><li>互动模式：restore -i [-f dumpfile]</li><li style="list-style: none; display: inline"><ul><li>实现部分文件的恢复</li><li>该模式下执行help命令可以列出菜单，主要功能如下</li><li style="list-style: none; display: inline"><ul><li>ls：列出dump内的文件和目录</li><li style="list-style: none; display: inline"><ul><li>待解压的文件或目录会有“*”作为前缀</li></ul></li><li>cd：在dump内更改目录</li><li>pwd：列出dump文件的路径文件名</li><li>add file：将file加入待解压的文件列表</li><li>delete：将file从待解压的文件列表中删除</li><li>extract：按照文件列表执行解压</li></ul></li></ul></li><li>还原整个文件系统：restore -r [-f dumpfile]</li><li style="list-style: none; display: inline"><ul><li>还原到当前目录下所在的文件系统</li></ul></li></ul></li><li>新建iso镜像文件：mkisofs</li><li style="list-style: none; display: inline"><ul><li>基本语法：mkisofs [-o 输出文件] [-rv] [-m file] 待备份文件.... [-V vol] -graft-point isodir=systemdir ....</li><li style="list-style: none; display: inline"><ul><li>-o：后接输出文件名</li><li>-r：通过Rock Ridge产生支持UNIX/Linux的文件数据，可记录较多的信息</li><li style="list-style: none; display: inline"><ul><li>默认使用ISO9660格式，该格式仅支持旧版DOS文件名，只能以“8.3”（文件名8字符，扩展名3字符）的方式存在</li><li>加入该参数，可以记录比较完整的信息，包括UID/GID、权限等</li></ul></li><li>-v：显示过程</li><li>-m file：排除file文件</li><li>-V vol：新建Volume</li><li>-graft-point isodir=systemdir：（转嫁、移植）指定待备份文件放置在光盘下的哪个目录</li><li style="list-style: none; display: inline"><ul><li>默认文件都丢在光盘根目录上</li><li>如：/linux/etc=/etc表示将带备份文件/etc目录放置到光盘的/linux/etc目录下</li><li>该参数后面的文件就是要备份的文件，无需重新写出备份文件</li></ul></li><li>如：mkisofs -r -V 'Linux_file' -o /tmp/system.img -m /home/lost+found -graft-point /root=/root /home=/home /etc=/etc</li></ul></li></ul></li><li>光盘刻录工具：cdrecord</li><li style="list-style: none; display: inline"><ul><li>查询刻录机位置：cdrecord -scanbus dev=ATA</li><li style="list-style: none; display: inline"><ul><li>-scanbus：扫描磁盘总线并找出可用的刻录机，后接设备接口</li><li style="list-style: none; display: inline"><ul><li>早期刻录机采用SCSI接口，目前一般为IDE或SATA接口，ATA模式能同时查询这两种接口</li><li><br></li></ul></li></ul></li><li>抹除重复读写片：cdrecord -v dev=ATA:x,y,z blank=[fast | all]</li><li style="list-style: none; display: inline"><ul><li>dev=ATA:x,y,z：后接设备接口，及刻录机的位置（x，y，z）</li><li>blank=[fast | all]：抹除可重复写入的CD/DVD-RW，fast较快，all较完整</li></ul></li><li>格式化DVD+RM：cdrecord -v dev=ATA:x,y,z -format</li><li style="list-style: none; display: inline"><ul><li>-format：仅针对DVD+RW格式的DVD</li></ul></li><li>刻录：cdrecord -v dev=ATA:x,y,z [可用参数功能] file.iso</li><li style="list-style: none; display: inline"><ul><li>-data：以数据格式写入，而不是以CD音轨（-audio）方式写入</li><li>speed=X：指定刻录速度</li><li>-eject：刻录完毕后自动退出光盘</li><li>fs=Ym：指定缓冲存储器为YM，可将镜像文件先暂存到暂存区</li><li style="list-style: none; display: inline"><ul><li>默认为4M</li><li>一般可增加到8M，视刻录机而定</li></ul></li><li>======以下参数针对DVD，写入DVD时必须加入这两个参数======</li><li>driveropts=burnfree：打开Buffer Underrun Free模式写入功能</li><li>-sao：支持DVD-RW格式</li></ul></li><li>光盘种类</li><li style="list-style: none; display: inline"><ul><li>CD有CD-R、CD-RW</li><li>DVD有DVD-R、DVD+R、DVD-RW、DVD+RW</li><li>（R为一次写入，RW为重复写入）</li><li>！！！DVD+RW的抹除方法比较特殊，是用-format参数</li></ul></li><li>对于CD-RW，直接刻录会自动抹除数据</li><li>对于DVD-RW，直接刻录不会主动进入自动抹除功能，需要手动抹除</li></ul></li><li>打包、制作空文件：dd</li><li style="list-style: none; display: inline"><ul><li>基本语法：dd if=&quot;input file&quot; of=&quot;output file&quot; bs=&quot;block size&quot; count=&quot;number&quot;</li><li style="list-style: none; display: inline"><ul><li>if：输入文件或设备</li><li>of：输出文件或设备</li><li>bs：规划block大小</li><li style="list-style: none; display: inline"><ul><li>默认为512bytes</li></ul></li><li>count：指定block个数</li></ul></li><li>执行结果的行首会出现”x+y“的信息（如”3+1“）</li><li style="list-style: none; display: inline"><ul><li>x是使用的完整block个数</li><li>y是使用的未满的block个数</li></ul></li><li>该命令常用于备份，如果要恢复，把if和of倒过来即可</li><li>备份：tar和dd</li><li style="list-style: none; display: inline"><ul><li>备份关键数据：tar</li><li>备份整块分区或者整块硬盘：dd</li></ul></li><li>恢复分区时，新建的分区不需要格式化就可以直接作为恢复的目的分区</li><li style="list-style: none; display: inline"><ul><li>因为dd会把分区中扇区表面的数据整个复制过来</li><li>包括superblock, boot sector, meta data等</li></ul></li></ul></li><li>强力备份：cpio</li><li style="list-style: none; display: inline"><ul><li>备份：cpio -ovcB &gt; [file | device]</li><li style="list-style: none; display: inline"><ul><li>-o：将数据copy输出到文件或设备上</li><li>-v：让存储过程中文件名显示到屏幕上</li><li>-c：一种较新的portable format方式存储</li><li>-B：让blocks增加到5120bytes，方便大文件的存储</li><li style="list-style: none; display: inline"><ul><li>默认是512bytes</li></ul></li></ul></li><li>还原：cpio -ivcdu &lt; [file | device]</li><li style="list-style: none; display: inline"><ul><li>-i：将数据从文件或设备复制到系统中</li><li>-d：自动新建目录</li><li>-u：自动将较新的文件覆盖旧文件</li></ul></li><li>查看：cpio -ivct &lt; [file |device]</li><li style="list-style: none; display: inline"><ul><li>-t：配合-i，用于查看以cpio新建的文件或设备的内容</li></ul></li><li>cpio可以备份任何东西，甚至设备文件</li><li>cpio不会主动去找文件来备份，需要find等命令结合管道命令和数据流重定向来找到文件名并且告知cpio</li><li>如</li><li style="list-style: none; display: inline"><ul><li>find /boot -print先找出/boot下的文件</li><li>find /boot | cpio -ocvB &gt; /tmp/boot.cpio 将/boot备份出来</li></ul></li></ul></li></ul></div>
</div></a></body></html>\00
